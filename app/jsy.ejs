<!DOCTYPE html>
<html lang="zh">

	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<title>结算</title>
		<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
		<link rel="stylesheet" type="text/css" href="css/reset.css" />
		<link rel="stylesheet" type="text/css" href="css/common.css" />
		<link rel="stylesheet" type="text/css" href="css/jsy.css" />
		<script src="js/lib/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/lib/vue.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/lib/vue-resource.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/lib/jquery.pagination.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/lib/distpicker.data.js"></script>
		<script src="js/lib/distpicker.js"></script>
	</head>

	<body>

		<div class="loginWrap">
			<div class="loginMain">
				<header class="loginHeadWrap toPage">
					<div class="loginHead">
						<div class="lFloat">
							<a :href="toPagesArr.index">
								<img src="images/logo.png" class="logo" />
							</a>
							<h2>结算页</h2>
						</div>
						<div class="rFloat step">
							<div class="box_1">
								<div class="clearfix">
									<span class="line lFloat"></span>
									<span class="num lFloat">1</span>
									<span class="line lFloat"></span>
								</div>
								<p>1.我的购物车</p>
							</div>

							<div class="box_2">
								<div class="clearfix">
									<span class="line lFloat"></span>
									<span class="num lFloat">2</span>
									<span class="line lFloat"></span>
								</div>
								<p>2.填写核对订单信息</p>
							</div>

							<div class="box_3">
								<div class="clearfix">
									<span class="line lFloat"></span>
									<span class="num lFloat">3</span>
									<span class="line lFloat"></span>
								</div>
								<p>3.成功提交订单</p>
							</div>
						</div>
					</div>
				</header>

				<div class="jsyMain">
					<p class="title">填写并核对订单信息</p>
					<div class="content">
						<div class="consigneeWrap">
							<p class="title clearfix">
								<span class="lFloat">收货人信息</span>
								<span class="rFloat add" @click="addConsigneeMsg(true,1)">新增收货地址</span>
							</p>

							<!--只展示三条收货地址-->
							<div class="consignee" v-if="!unfoldAddress">
								<div class="line clearfix" v-for="(item,index) in threeUserReceiveInfoList">
									<div v-if="item.is_default=='1'">
										<span class="name lFloat">{{item.receive_name}}</span>
										<div class="rFloat consigneeMsg" @click="choseReceivingAddr($event,index,item.receive_region,item.receive_address,item.receive_name,item.receive_phone,item.id)">
											<span class="msg">{{item.receive_region.replace(/,/g,"")}} {{item.receive_address}} {{item.receive_phone}}</span>
											<span class="defAddress">默认地址</span>
											<span class="edit rFloat" @click="editCollectGoods(item.id,item.receive_name,item.receive_region,item.receive_address,item.receive_phone)">编辑</span>
											<p class="mask"></p>
											<p class="mask2" style="display: block;"></p>
										</div>
									</div>

									<div v-if="item.is_default=='0'">
										<span class="name lFloat">{{item.receive_name}}</span>
										<div class="rFloat consigneeMsg" @click="choseReceivingAddr($event,index,item.receive_region,item.receive_address,item.receive_name,item.receive_phone,item.id)">
											<span class="msg">{{item.receive_region.replace(/,/g,"")}} {{item.receive_address}} {{item.receive_phone}}</span>
											<span class="setDefAddress rFloat" @click="updateAddressToDefault(item.id)">设为默认地址</span>
											<span class="edit rFloat" @click="editCollectGoods(item.id,item.receive_name,item.receive_region,item.receive_address,item.receive_phone)">编辑</span>
											<span class="del rFloat" @click="delConsigneeMsg(true,item.id)">删除</span>
											<p class="mask"></p>
											<p class="mask2"></p>
										</div>
									</div>
								</div>
								<p class="unfoldAddress" v-if="unfoldAddress" @click="unfoldAddressClick()">收起地址<img src="images/takeUp.png" /></p>
								<p class="unfoldAddress" v-if="!unfoldAddress" @click="unfoldAddressClick()">展开地址<img src="images/openAddress.png" /></p>
							</div>

							<!--展开全部收货地址-->
							<div class="consignee" v-if="unfoldAddress">
								<div class="line clearfix" v-for="(item,index) in userReceiveInfoList">
									<div v-if="item.is_default=='1'">
										<span class="name lFloat">{{item.receive_name}}</span>
										<div class="rFloat consigneeMsg" @click="choseReceivingAddr($event,index,item.receive_region,item.receive_address,item.receive_name,item.receive_phone,item.id)">
											<span class="msg">{{item.receive_region.replace(/,/g,"")}} {{item.receive_address}} {{item.receive_phone}}</span>
											<span class="defAddress">默认地址</span>
											<span class="edit rFloat" @click="editCollectGoods(item.id,item.receive_name,item.receive_region,item.receive_address,item.receive_phone)">编辑</span>
											<p class="mask"></p>
											<p class="mask2" style="display: block;"></p>
										</div>
									</div>

									<div v-if="item.is_default=='0'">
										<span class="name lFloat">{{item.receive_name}}</span>
										<div class="rFloat consigneeMsg" @click="choseReceivingAddr($event,index,item.receive_region,item.receive_address,item.receive_name,item.receive_phone,item.id)">
											<span class="msg">{{item.receive_region.replace(/,/g,"")}} {{item.receive_address}} {{item.receive_phone}}</span>
											<span class="setDefAddress rFloat" @click="updateAddressToDefault(item.id)">设为默认地址</span>
											<span class="edit rFloat" @click="editCollectGoods(item.id,item.receive_name,item.receive_region,item.receive_address,item.receive_phone)">编辑</span>
											<span class="del rFloat" @click="delConsigneeMsg(true,item.id)">删除</span>
											<p class="mask"></p>
											<p class="mask2"></p>
										</div>
									</div>
								</div>
								<p class="unfoldAddress" v-if="unfoldAddress" @click="unfoldAddressClick()">收起地址<img src="images/takeUp.png" /></p>
								<p class="unfoldAddress" v-if="!unfoldAddress" @click="unfoldAddressClick()">展开地址<img src="images/openAddress.png" /></p>
							</div>
						</div>

						<div class="payMethodWrap">
							<p class="title clearfix">
								<span class="lFloat">支付方式</span>
							</p>
							<p>
								<button v-if="!weChatPay" @click="payWayClick(1)">微信支付</button>
								<button style="border: 0.066666rem solid #cd2f1d;" v-if="weChatPay">微信支付</button>
								<button v-if="!alipayPay" @click="payWayClick(2)">支付宝支付</button>
								<button style="border: 0.066666rem solid #cd2f1d;" v-if="alipayPay">支付宝支付</button>
							</p>
						</div>

						<div class="listWrap">
							<p class="title clearfix">
								<span class="lFloat">送货清单</span>
							</p>

							<div class="heading">
								<p>商品名称</p>
								<p>商品属性</p>
								<p>单价</p>
								<p>数量</p>
								<p>小计</p>
							</div>
							<ul>
								<li class="clearfix" v-for="item in orderDataList">
									<p class="clearfix">
										<img :src="item.data.original_img" class="lFloat" />
										<span class="lFloat">{{item.data.goods_name}}</span>
									</p>
									<p>
										<span style="display: block;" v-for="attr in item.data.attr" v-if="item.data.attr!=''">{{attr.attrName}}：{{attr.attrValue}}</span>
										<span style="display: block;opacity: 0;" v-if="item.data.attr==''">无</span>
									</p>
									<p>
										¥{{item.data.price|money}}
									</p>
									<p class="clearfix">{{item.itemNum}}</p>
									<p>
										¥{{item.itemNum*item.data.price|money}}
									</p>
								</li>
							</ul>
						</div>
					</div>
					<div class="balanceWrap clearfix">
						<div>
							<p><span class="num">{{totalGoodsNum}}</span> 件商品，应付金额：<span class="money">¥{{this.totalMoney|money}}</span></p>
							<p>寄送至：{{receivingAddress}}<span class="addressee">收件人：{{addressee}}&nbsp;&nbsp;{{addresseePhone}}</span></p>
						</div>
						<span class="submitOrder rFloat" @click="createOrder()">提交订单</span>
					</div>

					<!--删除收货人信息弹窗-->
					<div class="deleteBox" v-if="delBox">
						<p class="title clearfix">
							<span class="lFloat">删除收货人信息</span>
							<img src="images/close_del_box.png" class="rFloat" @click="confirmDelCollectGoods(2)" />
						</p>
						<p>
							<img src="images/del_icon.png" class="delIcon" /> 您确定要删除该收获地址吗？
						</p>
						<p>
							<button @click="confirmDelCollectGoods(1)">确定</button>
							<button @click="confirmDelCollectGoods(2)">取消</button>
						</p>
					</div>

					<!--新增收货人信息-->
					<div class="addConsigneeMsg" v-if="addBox">
						<p class="title clearfix">
							<span class="lFloat">新增收货人信息</span>
							<img src="images/close_del_box.png" class="rFloat" @click="addConsigneeMsg(false,2)" />
						</p>
						<div class="addContent">
							<div class="place">
								<span><i>*</i>所在地区</span>
								<!--省市区三级联动插件-->
								<div id="distpicker4">
									<select v-model="province"></select>
									<select v-model="city"></select>
									<select v-model="area"></select>
								</div>
								<input type="hidden" v-model="receiveRegion" class="receiveRegion" />
							</div>
							<p>
								<span><i>*</i>收货人</span>
								<input type="text" v-model="receiveName" />
							</p>
							<p>
								<span><i>*</i>详细地址</span>
								<input type="text" v-model="receiveAddress" />
							</p>
							<p>
								<span><i>*</i>手机号码</span>
								<input type="text" v-model="receivePhone" />
								<span class="errorTip" v-if="!phoneErrorTip">手机号码不正确</span>
							</p>
							<p>
								<button @click="addConsigneeMsg(false,3)" v-if="receiveName!=''&&receivePhone!=''&&receiveAddress!=''&&province!=''&&city!=''">保存收货人信息</button>
								<button style="background: #ccc;color: #fafafa;" v-if="receiveName==''||receivePhone==''||receiveAddress==''||province==''||city==''">保存收货人信息</button>
							</p>
						</div>
					</div>

					<!--编辑收货人信息-->
					<div class="addConsigneeMsg" v-if="editBox">
						<p class="title clearfix">
							<span class="lFloat">编辑收货人信息</span>
							<img src="images/close_del_box.png" class="rFloat" @click="editConsigneeMsg(false,2)" />
						</p>
						<div class="addContent">
							<div class="place">
								<span><i>*</i>所在地区</span>
								<!--省市区三级联动插件-->
								<div id="distpicker5">
									<select v-model="editProvince"></select>
									<select v-model="editCity"></select>
									<select v-model="editArea"></select>
								</div>
								<input type="hidden" v-model="receiveRegion" class="receiveRegion" />
							</div>
							<p>
								<span><i>*</i>收货人</span>
								<input type="text" v-model="editName" />
							</p>
							<p>
								<span><i>*</i>详细地址</span>
								<input type="text" v-model="editAddress" />
							</p>
							<p>
								<span><i>*</i>手机号码</span>
								<input type="text" v-model="editPhone" />
								<span class="errorTip" v-if="!phoneErrorTip">手机号码不正确</span>
							</p>
							<p>
								<button @click="editConsigneeMsg(false,3)" v-if="editName!=''&&editAddress!=''&&editPhone!=''&&editProvince!=''&&editCity!=''">保存收货人信息</button>
								<button style="background: #ccc;color: #fafafa;" v-if="editName==''&&editAddress==''&&editPhone==''&&editProvince==''&&editCity==''">保存收货人信息</button>
							</p>
						</div>
					</div>

					<div class="frameMask" v-if="delBox||addBox||editBox"></div>
				</div>
			</div>

			<div class="copyRight">
				<p>CopyRight © 筑家优品 沪ICP备17040405号-1</p>
			</div>
		</div>

		<script src="js/common.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/jsy.js" type="text/javascript" charset="utf-8"></script>
	</body>

</html>